pico-8 cartridge // http://www.pico-8.com
version 16
__lua__

-- player
fireball = {
  sprite = 3,
  drawing = false,
  position = { x = 0,  y = 0 },
  speed = 3
}

player = {}
player.x = 5
player.y = 10
player.sprite = 0
player.speed = 2
player.life = 5
player.max_life = 5
player.spells = {}
player.attacking = false
player.spells = {}
player.spells["fireball"] = fireball

function move()
  player.moving = true
  player.sprite += 1
  if player.sprite > 2 then
   player.sprite = 0
  end
end

function draw_player()
  spr(player.sprite, player.x, player.y)
  if player.attacking == true or player.spells.fireball.drawing == true then
    draw_fireball()
  end
end

function draw_fireball()
  fireball_ = player.spells.fireball
  if fireball_.drawing == true then
    fireball_.position.x += fireball_.speed
    if fireball_.position.x > screen_size then
      fireball_.drawing = false
    end
  else
    fireball_.drawing = true
    fireball_.position.x = player.x + 4
    fireball_.position.y = player.y
  end
  spr(fireball_.sprite, fireball_.position.x, fireball_.position.y)
end


-- menu
menu = {}
menu.display = false
menu.items = {"character", "inventory", "spells"}

function togglemenu()
  if menu.display == true then
    menu.display = false
  else
    menu.display = true
  end
end

function print_menu_item(item)
  print("-> " .. item)
end

-- user interface
screen_size = 128
ui_width = screen_size
ui_height= 6
function draw_ui()
  line(0, ui_height, ui_width, ui_height, 7)
  print("life: " .. player.life .. "/" .. player.max_life)
end

-- engine
function _update()
  player.moving = false
  if btnp(4) then
    togglemenu()
  end
  if menu.display == false then
    if btn(0) and player.x > 1 then
      player.x -= player.speed
      move()
    end
    if btn(1) and player.x < screen_size - 2 then
      player.x += player.speed
      move()
    end
    if btn(2) and player.y > ui_height + 2 then
      player.y -= player.speed
      move()
    end
    if btn(3) and player.y < screen_size - 2 then
      player.y += player.speed
      move()
    end
    if btn(5) then
      player.attacking = true
    else
      player.attacking = false
    end
  end
  if not player.moving then
    player.sprite = 0
  end
end

function _draw()
  cls()
  draw_ui()
  draw_player()
  if menu.display == true then
    foreach(menu.items, print_menu_item)
  end
end


__gfx__
0ffff0000ffff0000ffff000000aaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0f44f0000f44f0000f44f000000a8900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0bbbb0000bbbb0000bbbb0000aa88aa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbaabb00bbaabb00bbaabb00aa88889a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
fbbbbf00fbbbbf00fbbbbf00aa888889000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05555000055550000555500009a88a9a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
050050000500c0000c00500000a98a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0c00c0000c0000000000c000000aaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1818181818181818181818181818181800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1818181818181818181818181818181800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1818181818181818181818181818181800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1818181818181818181818181818181800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
